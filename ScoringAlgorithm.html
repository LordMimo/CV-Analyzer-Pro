<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CV Scoring System</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    textarea { width: 100%; height: 200px; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px 20px; cursor: pointer; }
    .result { margin-top: 20px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px #ccc; }
    .score { font-size: 20px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>CV Scoring System</h2>
  <p>Paste your CV text below:</p>
  <textarea id="cvText"></textarea><br>
  <button onclick="analyzeCV()">Analyze CV</button>

  <div id="result" class="result" style="display:none;">
    <p class="score"></p>
    <p class="recommendations"></p>
  </div>

  <script>
    function analyzeCV() {
        // 1. Get Inputs and Normalize Text
        const text = document.getElementById("cvText").value;
        const jobTitle = document.getElementById("jobTitle").value.toLowerCase(); // NEW: Get Job Title
        const lowerText = text.toLowerCase();
        
        if (!lowerText.trim() || !jobTitle.trim()) {
            alert("Please paste your CV text and enter a target job title first!");
            return;
        }

        let calculatedScore = 0;
        let recommendations = [];
        const wordCount = lowerText.split(/\s+/).filter(word => word.length > 0).length;

        // --- Job-Specific Keywords Mapping (New Data Structure) ---
        const jobKeywords = {
            'software engineer': ["python", "java", "sql", "aws", "docker", "agile", "microservices", "ci/cd", "rest api"],
            'marketing coordinator': ["seo", "sem", "hubspot", "analytics", "content strategy", "social media", "campaign", "a/b testing"],
            'administrative assistant': ["scheduling", "microsoft suite", "outlook", "excel", "record keeping", "budget management", "travel arrangement"],
        };

        // Select keyword list based on job title, default to a general list
        let targetKeywords = jobKeywords[Object.keys(jobKeywords).find(key => jobTitle.includes(key))] || jobKeywords['software engineer'];
        if (targetKeywords.length < 5) {
             recommendations.push("üí° **Keyword Specificity:** Consider entering a more common job title to improve keyword matching accuracy.");
        }


        // --- 2. Scoring Components ---

        // (Remaining Structure, Quantifiability, and Action Verb scoring remains the same from the previous enhancement)

        // 2.1 SECTION STRUCTURE & LENGTH (Max 15 points) - UNCHANGED
        let structurePoints = 0;
        const requiredSections = ["education", "experience", "skills", "contact"];
        requiredSections.forEach(section => {
            if (lowerText.includes(section)) structurePoints += 3;
        });
        if (wordCount >= 250 && wordCount <= 700) {
            structurePoints += 3;
        } else if (wordCount > 700) {
            recommendations.push("‚ùå **Conciseness:** Your CV might be too long. Aim for 1-2 pages of highly relevant content.");
        } else {
            recommendations.push("‚ö†Ô∏è **Detail:** Your CV seems too short. Add more detailed, results-oriented bullet points.");
        }
        calculatedScore += Math.min(15, structurePoints);

        // 2.2 QUANTIFIABILITY (Max 30 points) - UNCHANGED
        const quantifiablePattern = /(\d+[\+\-]?%?|increased|reduced|saved|managed|improved|built)\s+\d+/gi;
        const metricsFound = (text.match(quantifiablePattern) || []).length;
        let quantifiabilityPoints = Math.min(30, metricsFound * 5);
        calculatedScore += quantifiabilityPoints;
        if (metricsFound < 4) {
            recommendations.push(`‚ö†Ô∏è **Quantify Results:** Found only ${metricsFound} metrics. Replace "responsible for" tasks with numerical achievements (e.g., increased efficiency by 15%).`);
        }

        // 2.3 IMPACTFUL LANGUAGE (Action Verbs) (Max 25 points) - UNCHANGED
        const strongActionVerbs = ["architected", "developed", "spearheaded", "optimized", "implemented", "managed", "designed", "resolved", "launched", "automated", "created"];
        let verbCount = 0;
        strongActionVerbs.forEach(verb => {
            const verbPattern = new RegExp('\\.\\s*' + verb + '|\\*\\s*' + verb, 'gi');
            verbCount += (lowerText.match(verbPattern) || []).length;
        });
        let verbPoints = Math.min(25, verbCount * 4);
        calculatedScore += verbPoints;
        if (verbCount < 5) {
             recommendations.push(`‚ùå **Action Verbs:** Use strong action verbs to start your bullet points. Found only ${verbCount} impactful verbs.`);
        }

        // 2.4 KEYWORD DENSITY (Job-Specific) (Max 30 points) - MODIFIED
        let keywordPoints = 0;
        let matchedKeywords = [];
        let missingKeywords = [];

        targetKeywords.forEach(word => {
            if (lowerText.includes(word)) {
                keywordPoints += 30 / targetKeywords.length; // Distribute 30 points evenly
                matchedKeywords.push(word);
            } else {
                missingKeywords.push(word);
            }
        });

        calculatedScore += Math.min(30, keywordPoints);

        if (missingKeywords.length > 0) {
            recommendations.push(`‚ö†Ô∏è **Keyword Match:** Missing crucial keywords for this role: ${missingKeywords.slice(0, 4).join(', ')}. Include them in your experience section.`);
        }


        // --- 3. Final Output & Redirection ---

        calculatedScore = Math.min(100, Math.round(calculatedScore));

        // Display results (optional for the scoring page)
        document.getElementById("result").style.display = "block";
        document.querySelector(".score").innerHTML = `üß† CV Score: <strong>${calculatedScore}/100</strong>`;
        document.querySelector(".recommendations").innerHTML =
         recommendations.length ? "üìã Recommendations:<br> - " + recommendations.join("<br> - ") :
         "‚úÖ Great job! Your CV looks well-structured and detailed.";
        
        // Final action: Redirect to the results page, passing the CALCULATED score and the job title.
        // In a real application, you would pass ALL results data, but for this demo, we'll pass the score and title.
        
        const scoreString = calculatedScore.toString();
        const roleString = encodeURIComponent(jobTitle);
        
        // Redirect to the Results page with calculated data in the URL
        window.location.href = `ResultsPageUI.html?score=${scoreString}&role=${roleString}`;
    }
</script>
</body>
</html>
