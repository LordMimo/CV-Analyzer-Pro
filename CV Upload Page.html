<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Upload Portal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import for better aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
    </style>
</head>
<body>

<div id="app" class="w-full max-w-lg bg-white p-8 md:p-10 rounded-xl shadow-2xl transition-all duration-300">
    <header class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-gray-800">Upload Your CV</h1>
        <p class="text-gray-500 mt-2">PDF or DOCX, Max 5MB</p>
    </header>

    <form id="uploadForm" class="space-y-6">
        <!-- File Input -->
        <div>
            <label for="cvFile" class="block text-sm font-medium text-gray-700 mb-2">Select CV File</label>
            <input type="file" id="cvFile" name="cvFile" accept=".pdf, .docx" required
                   class="block w-full text-sm text-gray-500
                          file:mr-4 file:py-2 file:px-4
                          file:rounded-lg file:border-0
                          file:text-sm file:font-semibold
                          file:bg-indigo-50 file:text-indigo-600
                          hover:file:bg-indigo-100
                          border border-gray-300 rounded-lg p-3 cursor-pointer">
        </div>

        <!-- Validation Message Area -->
        <div id="message" class="hidden p-3 rounded-lg text-sm transition-all duration-300"></div>

        <!-- Progress Bar Container -->
        <div id="progressBarContainer" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-1">Upload Progress</label>
            <div class="w-full bg-gray-200 rounded-full h-3.5">
                <div id="progressBar" class="bg-indigo-600 h-3.5 rounded-full text-xs font-medium text-white text-center p-0.5" style="width: 0%">
                </div>
            </div>
            <p id="progressText" class="text-xs text-gray-500 mt-1 text-right">0%</p>
        </div>

        <!-- Submit Button -->
        <button type="submit" id="submitButton"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200 disabled:opacity-50"
                disabled>
            Upload CV
        </button>
    </form>
</div>

<script>
    const form = document.getElementById('uploadForm');
    const fileInput = document.getElementById('cvFile');
    const messageDiv = document.getElementById('message');
    const submitButton = document.getElementById('submitButton');
    const progressBarContainer = document.getElementById('progressBarContainer');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    // Constants for validation
    const MAX_FILE_SIZE_BYTES = 5 * 1024 * 1024; // 5 MB
    const ALLOWED_MIMES = [
        'application/pdf',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document' // DOCX
    ];
    const ALLOWED_EXTENSIONS = ['.pdf', '.docx'];

    // --- Utility Functions ---

    /**
     * Displays a validation or status message.
     * @param {string} text The message content.
     * @param {string} type 'success', 'error', or 'info'.
     */
    function displayMessage(text, type) {
        // Clear previous classes
        messageDiv.className = 'p-3 rounded-lg text-sm transition-all duration-300';

        switch (type) {
            case 'success':
                messageDiv.classList.add('bg-green-100', 'text-green-800');
                break;
            case 'error':
                messageDiv.classList.add('bg-red-100', 'text-red-800');
                break;
            case 'info':
            default:
                messageDiv.classList.add('bg-blue-100', 'text-blue-800');
                break;
        }

        messageDiv.textContent = text;
        messageDiv.classList.remove('hidden');
    }

    /**
     * Checks if the selected file is valid (type and size).
     * @param {File} file The file object.
     * @returns {boolean} True if valid, false otherwise.
     */
    function validateFile(file) {
        if (!file) {
            displayMessage('Please select a file to upload.', 'error');
            return false;
        }

        // 1. Size Validation
        if (file.size > MAX_FILE_SIZE_BYTES) {
            const maxSizeMB = MAX_FILE_SIZE_BYTES / (1024 * 1024);
            displayMessage(`File size exceeds the maximum limit of ${maxSizeMB}MB.`, 'error');
            return false;
        }

        // 2. Type Validation (checking extension for broader support)
        const fileName = file.name.toLowerCase();
        const isValidType = ALLOWED_EXTENSIONS.some(ext => fileName.endsWith(ext));

        // Note: MIME type checking (file.type) is generally more reliable but can be spoofed.
        // We'll stick to a combination of input 'accept' attribute and extension check here.
        if (!isValidType) {
            displayMessage('Invalid file type. Only PDF (.pdf) and DOCX (.docx) files are allowed.', 'error');
            return false;
        }

        // Clear any previous error messages
        messageDiv.classList.add('hidden');
        return true;
    }

    // --- Event Listeners ---

    // Enable/Disable button based on file selection
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            const isValid = validateFile(fileInput.files[0]);
            submitButton.disabled = !isValid;
        } else {
            submitButton.disabled = true;
            messageDiv.classList.add('hidden');
        }
        // Hide progress bar on new file selection
        progressBarContainer.classList.add('hidden');
        progressBar.style.width = '0%';
        progressText.textContent = '0%';
    });

    // Form Submission Handler (Simulated Upload)
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const file = fileInput.files[0];

        // Re-validate just before submission
        if (!validateFile(file)) {
            submitButton.disabled = true;
            return;
        }

        // Start Simulation
        submitButton.disabled = true;
        fileInput.disabled = true;
        displayMessage(`Uploading "${file.name}"...`, 'info');
        progressBarContainer.classList.remove('hidden');

        let progress = 0;
        const totalDuration = 2500; // 2.5 seconds total simulation time
        const intervalTime = 100; // Update every 100ms
        const increment = (intervalTime / totalDuration) * 100;

        const uploadInterval = setInterval(() => {
            progress += increment;

            if (progress >= 100) {
                progress = 100;
                clearInterval(uploadInterval);
                
                // Final update and success message
                updateProgressBar(100);
                displayMessage(`Success! Your CV "${file.name}" has been uploaded.`, 'success');
                
                // Reset form state after a short delay
                setTimeout(resetForm, 1500);

            } else {
                updateProgressBar(progress);
            }
        }, intervalTime);
    });

    /**
     * Updates the visual state of the progress bar.
     * @param {number} percentage The current percentage (0-100).
     */
    function updateProgressBar(percentage) {
        const p = Math.min(100, Math.round(percentage));
        progressBar.style.width = `${p}%`;
        progressText.textContent = `${p}%`;
        // Add a pulsing effect when actively uploading (0 < p < 100)
        if (p > 0 && p < 100) {
            progressBar.classList.add('animate-pulse');
        } else {
            progressBar.classList.remove('animate-pulse');
        }
    }

    /**
     * Resets the form to its initial state.
     */
    function resetForm() {
        form.reset();
        submitButton.disabled = true;
        fileInput.disabled = false;
        progressBarContainer.classList.add('hidden');
        progressBar.style.width = '0%';
        progressText.textContent = '0%';
        messageDiv.classList.add('hidden'); // Optionally clear the success message
    }

</script>

</body>
</html>
